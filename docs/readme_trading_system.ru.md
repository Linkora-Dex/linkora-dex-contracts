# DEX Trading System - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ upgradeable –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏:
- **TradingUpgradeable** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞–º–∏ –∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
- **PoolUpgradeable** - AMM –ø—É–ª –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é
- **OracleUpgradeable** - —Ü–µ–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **RouterUpgradeable** - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

## üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏

### üîÑ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä—è–º–æ–π swap (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ–±–º–µ–Ω)

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –î–µ–ø–æ–∑–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø—É–ª —á–µ—Ä–µ–∑ `depositETH()` –∏–ª–∏ `depositToken()`
2. –í—ã–±–æ—Ä –ø–∞—Ä—ã –¥–ª—è –æ–±–º–µ–Ω–∞ (ETH ‚Üí Token –∏–ª–∏ Token ‚Üí Token)
3. –£–∫–∞–∑–∞–Ω–∏–µ —Å—É–º–º—ã –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ (`minAmountOut`)
4. –í—ã–∑–æ–≤ `swapTokens()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ flash-loan –∑–∞—â–∏—Ç—ã
2. –†–∞—Å—á–µ—Ç –≤—ã—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã –ø–æ AMM —Ñ–æ—Ä–º—É–ª–µ
3. –°–ø–∏—Å–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–π –∫–æ–º–∏—Å—Å–∏–∏ 0.3%
4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π (70% LP, 30% —Å—Ç–µ–π–∫–µ—Ä–∞–º)
5. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –ü–ª–∞—Ç–∏—Ç 0.3% –∫–æ–º–∏—Å—Å–∏—é
- –û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

## ü§î –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### üìã –°—Ü–µ–Ω–∞—Ä–∏–π 2: –õ–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –î–µ–ø–æ–∑–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø—É–ª
2. –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–º–∏—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ `createLimitOrder()`
3. –£–∫–∞–∑–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π —Ü–µ–Ω—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (LONG/SHORT)
4. –û–∂–∏–¥–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ `lockFunds()`
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω—ã keeper'–∞–º–∏ –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥
4. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–∏ - –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `executeOrder()`
5. –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ swap'–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–Ω—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç 0.3% —Ç–æ—Ä–≥–æ–≤—É—é –∫–æ–º–∏—Å—Å–∏—é + 0.1% keeper'—É
- –°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –¥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–º–µ–Ω—ã

---

### üõ°Ô∏è –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°—Ç–æ–ø-–ª–æ—Å—Å –æ—Ä–¥–µ—Ä

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –û—Ç–∫—Ä—ã—Ç–∏–µ LONG –ø–æ–∑–∏—Ü–∏–∏
2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—â–∏—Ç–Ω–æ–≥–æ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞ —á–µ—Ä–µ–∑ `createStopLossOrder()`
3. –£–∫–∞–∑–∞–Ω–∏–µ —Ü–µ–Ω—ã –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —É–±—ã—Ç–∫–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è —Å—Ç–æ–ø-–æ—Ä–¥–µ—Ä–∞
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω—ã
3. –ü—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ —Å—Ç–æ–ø-—É—Ä–æ–≤–Ω—è - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–¥–∞–∂–∞
4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–±—ã—Ç–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ–ª—å—à–∏—Ö —É–±—ã—Ç–∫–æ–≤
- –ò—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ SHORT (–ø—Ä–æ–¥–∞–∂–∞)
- –ü–æ–º–æ–≥–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–ø–∏—Ç–∞–ª –ø—Ä–∏ –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏

---

### üìä –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—Ç–∫—Ä—ã—Ç–∏–µ LONG –ø–æ–∑–∏—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –î–µ–ø–æ–∑–∏—Ç –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞ –≤ ETH
2. –í—ã–±–æ—Ä —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –ø–ª–µ—á–∞ (1-100x)
3. –í—ã–∑–æ–≤ `openPosition()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ PnL –ø–æ–∑–∏—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–Ω–æ–π —Å—É–º–º—ã –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞
2. –†–∞—Å—á–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞: `size = collateral * leverage * price`
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞
4. –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç PnL: `(currentPrice - entryPrice) * size / entryPrice`

**–ü—Ä–∏–º–µ—Ä:**
- –ö–æ–ª–ª–∞—Ç–µ—Ä–∞–ª: $100, –ø–ª–µ—á–æ: 10x, —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞: $2000
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: $1000 
- –ü—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã –¥–æ $2200 (+10%): –ø—Ä–∏–±—ã–ª—å = $100 (—É–¥–≤–æ–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞)
- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –¥–æ $1800 (-10%): —É–±—ã—Ç–æ–∫ = $100 (–ø–æ—Ç–µ—Ä—è –¥–µ–ø–æ–∑–∏—Ç–∞)

---

### üìâ –°—Ü–µ–Ω–∞—Ä–∏–π 5: –û—Ç–∫—Ä—ã—Ç–∏–µ SHORT –ø–æ–∑–∏—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –î–µ–ø–æ–∑–∏—Ç –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞ –≤ ETH  
2. –í—ã–±–æ—Ä —Ç–æ–∫–µ–Ω–∞ –∏ –ø–ª–µ—á–∞ –¥–ª—è SHORT –ø–æ–∑–∏—Ü–∏–∏
3. –í—ã–∑–æ–≤ `openPosition()` —Å `isLong: false`

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞
2. –†–∞—Å—á–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –¥–ª—è SHORT
3. –û–±—Ä–∞—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç PnL: `(entryPrice - currentPrice) * size / entryPrice`

**–ü—Ä–∏–º–µ—Ä:**
- –ö–æ–ª–ª–∞—Ç–µ—Ä–∞–ª: $100, –ø–ª–µ—á–æ: 5x, —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞: $2000
- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –¥–æ $1800 (-10%): –ø—Ä–∏–±—ã–ª—å = $50
- –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ $2200 (+10%): —É–±—ã—Ç–æ–∫ = $50

---

### üî• –°—Ü–µ–Ω–∞—Ä–∏–π 6: –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏

**–¢—Ä–∏–≥–≥–µ—Ä—ã –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏:**
- LONG: –ø–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ 80%+ –æ—Ç —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
- SHORT: —Ä–æ—Å—Ç —Ü–µ–Ω—ã –Ω–∞ 80%+ –æ—Ç —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. Keeper –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫
2. –í—ã–∑–æ–≤ `liquidatePosition()` –ª—é–±—ã–º keeper'–æ–º
3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞: 10% keeper'—É, 90% LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
4. –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- –ü–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞
- –ü–æ–∑–∏—Ü–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –µ—â–µ –±–æ–ª—å—à–∏—Ö —É–±—ã—Ç–∫–æ–≤

---

### üíß –°—Ü–µ–Ω–∞—Ä–∏–π 7: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –î–µ–ø–æ–∑–∏—Ç –ø–∞—Ä–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ `addLiquidity()`
2. –£–∫–∞–∑–∞–Ω–∏–µ –∂–µ–ª–∞–µ–º—ã—Ö —Å—É–º–º –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ª–∏ –≤ –ø—É–ª–µ

**–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:**
1. –†–∞—Å—á–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–ø–æ—Ä—Ü–∏–π —Ç–æ–∫–µ–Ω–æ–≤
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `liquidityContributions[user][token]`
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö —Ä–µ–∑–µ—Ä–≤–æ–≤ –ø—É–ª–∞

**–î–æ—Ö–æ–¥—ã LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
- 70% –æ—Ç –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –∫–æ–º–∏—Å—Å–∏–π
- 90% –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –í—ã–≤–æ–¥ —á–µ—Ä–µ–∑ `claimFees()` –∏–ª–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

---

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 8: –†–∞–±–æ—Ç–∞ keeper'–∞

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥):**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
3. –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π

**–î–æ—Ö–æ–¥—ã keeper'–∞:**
- 0.1% –æ—Ç —Å—É–º–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—Ä–¥–µ—Ä–∞
- 10% –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞ –ø—Ä–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –°—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–ü—Ä–∏–º–µ—Ä –∑–∞—Ä–∞–±–æ—Ç–∫–∞:**
- –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ $1000: –¥–æ—Ö–æ–¥ $1
- –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–æ–º $500: –¥–æ—Ö–æ–¥ $50

### –ú–æ–∂–Ω–æ –ª–∏ —Ç–æ—Ä–≥–æ–≤–∞—Ç—å —Ñ—å—é—á–µ—Ä—Å–∞–º–∏?
**–ù–ï–¢.** –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –ø–æ–ª–Ω–æ–≥–æ –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞, –±–µ–∑ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ –∏ –ø–æ—Å—Ç–∞–≤–∫–∏. –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏, –∞ –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–µ —Ñ—å—é—á–µ—Ä—Å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–µ—á–æ (leverage)?
–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤–µ—Å—å –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª, –∞ –ø–ª–µ—á–æ –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏. –†–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–π–º–∞ –∏–ª–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –ù–ï–¢ - –µ—Å–ª–∏ –≤–Ω–µ—Å $100, —Ç–æ—Ä–≥—É–µ—à—å –Ω–∞ $100, –Ω–æ PnL —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –±—É–¥—Ç–æ —Ç–æ—Ä–≥—É–µ—à—å –Ω–∞ $1000 –ø—Ä–∏ –ø–ª–µ—á–µ 10x.

### –ú–æ–∂–µ—Ç –ª–∏ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ keeper?
**–ù–ï–¢.** –í—Å–µ keeper —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º `onlyRole(KEEPER_ROLE)`, –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å —á—É–∂–∏–µ –æ—Ä–¥–µ—Ä–∞ –∏–ª–∏ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è `selfExecuteOrder()` - –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö self-executable –æ—Ä–¥–µ—Ä–æ–≤.

### –°–∫–æ–ª—å–∫–æ –º–æ–∂–µ—Ç –±—ã—Ç—å keeper'–æ–≤?
**–ù–ï–û–ì–†–ê–ù–ò–ß–ï–ù–ù–û.** –†–æ–ª—å `KEEPER_ROLE` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ª—é–±–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ `grantRole()` –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞—Ä–º–∏—é –±–æ—Ç–æ–≤-keeper'–æ–≤ –¥–ª—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤.

---

## üìã –û—Ä–¥–µ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ—Ä–¥–µ—Ä–æ–≤

#### ‚úÖ LIMIT (0) - –õ–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞
```solidity
createLimitOrder(user, tokenIn, tokenOut, amountIn, targetPrice, minAmountOut, isLong)
```

**–õ–æ–≥–∏–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:**
- **LIMIT LONG** (`isLong: true`) - –ø–æ–∫—É–ø–∫–∞ –∫–æ–≥–¥–∞ `currentPrice <= targetPrice`
- **LIMIT SHORT** (`isLong: false`) - –ø—Ä–æ–¥–∞–∂–∞ –∫–æ–≥–¥–∞ `currentPrice >= targetPrice`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ–∫—É–ø–∫–∞ –∞–∫—Ç–∏–≤–∞ –ø–æ –≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ
- –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤–æ–π —Ü–µ–Ω—ã

#### ‚úÖ STOP_LOSS (1) - –°—Ç–æ–ø-–ª–æ—Å—Å –æ—Ä–¥–µ—Ä–∞
```solidity
createStopLossOrder(user, tokenIn, tokenOut, amountIn, stopPrice, minAmountOut)
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ñ–µ—Å—Ç–∫–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `isLong: false` (—Ç–æ–ª—å–∫–æ SHORT –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
- –ò—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ `currentPrice <= stopPrice`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—â–∏—Ç–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ LONG –ø–æ–∑–∏—Ü–∏–π

#### ‚ùå MARKET (2) - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ enum, –Ω–æ –ª–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ó–∞–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä—è–º—ã–º–∏ swap —Ñ—É–Ω–∫—Ü–∏—è–º–∏

#### ‚ùå CONDITIONAL (3) - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ enum, –Ω–æ –ª–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞–º–∏

**–°–æ–∑–¥–∞–Ω–∏–µ:**
- –°—Ä–µ–¥—Å—Ç–≤–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `lockFunds()`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç `minAmountOut` —Å —É—á–µ—Ç–æ–º slippage

**–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:**
- `executeOrder()` - —Ç–æ–ª—å–∫–æ –¥–ª—è KEEPER_ROLE
- `selfExecuteOrder()` - –¥–ª—è self-executable –æ—Ä–¥–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π —á–µ—Ä–µ–∑ `shouldExecuteOrder()`

**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –æ—Ç–º–µ–Ω–∞:**
- `modifyOrder()` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ minAmountOut
- `cancelOrder()` - –æ—Ç–º–µ–Ω–∞ —Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ä–µ–¥—Å—Ç–≤

---

## üîÑ –ü—Ä—è–º—ã–µ —Å–≤–∞–ø—ã (AMM)

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–≤–∞–ø—ã
```solidity
swapTokens(user, tokenIn, tokenOut, amountIn, minAmountOut)
```
- Flash-loan –∑–∞—â–∏—Ç–∞
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ

#### Keeper —Å–≤–∞–ø—ã
```solidity
executeSwapForUser(user, tokenIn, tokenOut, amountIn, minAmountOut)
```
- –î–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
- –†–∞–±–æ—Ç–∞ —Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏

### AMM –º–µ—Ö–∞–Ω–∏–∑–º
- **–§–æ—Ä–º—É–ª–∞:** `amountOut = (amountIn * reserveOut) / (reserveIn + amountIn)`
- **Slippage tolerance:** 5% (500 bps)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä—ã:** ETH ‚Üî ERC20, ERC20 ‚Üî ERC20

---

## üìä –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π, –∞ –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è

### –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π
```solidity
openPosition(user, token, collateralAmount, leverage, isLong)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ö–æ–ª–ª–∞—Ç–µ—Ä–∞–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- Leverage: 1-100x (–≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–∞—Å—á–µ—Ç PnL)
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: `size = (collateral * leverage * price) / 1e18`

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### ‚úÖ LONG –ø–æ–∑–∏—Ü–∏–∏
- –°—Ç–∞–≤–∫–∞ –Ω–∞ —Ä–æ—Å—Ç —Ü–µ–Ω—ã –∞–∫—Ç–∏–≤–∞
- –ü—Ä–∏–±—ã–ª—å –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã, —É–±—ã—Ç–æ–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
- –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã –Ω–∞ 80%+

#### ‚úÖ SHORT –ø–æ–∑–∏—Ü–∏–∏  
- –°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã –∞–∫—Ç–∏–≤–∞
- –ü—Ä–∏–±—ã–ª—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã, —É–±—ã—Ç–æ–∫ –ø—Ä–∏ —Ä–æ—Å—Ç–µ
- –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã –Ω–∞ 80%+

### –¢–∏–ø—ã –ø–æ–∑–∏—Ü–∏–π
- **LONG (0)** - —Å—Ç–∞–≤–∫–∞ –Ω–∞ —Ä–æ—Å—Ç —Ü–µ–Ω—ã
- **SHORT (1)** - —Å—Ç–∞–≤–∫–∞ –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã

### –†–∞—Å—á–µ—Ç PnL
```solidity
// LONG –ø–æ–∑–∏—Ü–∏—è
pnl = (currentPrice - entryPrice) * size / entryPrice

// SHORT –ø–æ–∑–∏—Ü–∏—è  
pnl = (entryPrice - currentPrice) * size / entryPrice
```

### –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π

#### –î–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
```solidity
closePosition(user, positionId)
```
- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º PnL

#### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è
```solidity
liquidatePosition(positionId)
```

**–£—Å–ª–æ–≤–∏—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏:**
- LONG: —É–±—ã—Ç–æ–∫ 80%+ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã
- SHORT: —É–±—ã—Ç–æ–∫ 80%+ –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã
- –ù–∞–≥—Ä–∞–¥–∞ –ª–∏–∫–≤–∏–¥–∞—Ç–æ—Ä—É: 5% –æ—Ç –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞

---

## üíß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
```solidity
addLiquidity(tokenA, tokenB, amountADesired, amountBDesired, amountAMin, amountBMin)
```

**–ú–µ—Ö–∞–Ω–∏–∑–º:**
- –ü–∞—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –£—á–µ—Ç –¥–æ–ª–µ–π —á–µ—Ä–µ–∑ `liquidityContributions`
- –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∫–æ–º–∏—Å—Å–∏–π

### –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
```solidity
removeLiquidity(tokenA, tokenB, liquidity, amountAMin, amountBMin)
```

**–í–æ–∑–≤—Ä–∞—Ç:**
- –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–æ–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π

### –î–æ—Ö–æ–¥—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
```solidity
claimFees(token)
```

**–†–∞—Å—á–µ—Ç –¥–æ–ª–µ–π:**
```
userShare = (totalFees * userContribution) / totalContribution
claimableAmount = userShare - alreadyClaimed
```

---

## üí∞ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤

### –¢–æ—Ä–≥–æ–≤—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ —Å–≤–∞–ø–∞—Ö
- **–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞:** 0.3% –æ—Ç —Å—É–º–º—ã —Å–¥–µ–ª–∫–∏
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** 
  - 70% ‚Üí LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Ö –¥–æ–ª—è–º
  - 30% ‚Üí —Å—Ç–µ–π–∫–µ—Ä–∞–º governance —Ç–æ–∫–µ–Ω–∞ (—á–µ—Ä–µ–∑ router)
- **–°–∫–∏–¥–∫–∏:** –¥–ª—è —Å—Ç–µ–π–∫–µ—Ä–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—á–µ—Ä–µ–∑ router)

### –ö–æ–º–∏—Å—Å–∏–∏ –∑–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- **–°—Ç–∞–≤–∫–∞:** 0.1% –æ—Ç –≤—ã—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã (`amountOut`)
- **–ü–æ–ª—É—á–∞—Ç–µ–ª—å:** keeper –∏—Å–ø–æ–ª–Ω–∏–≤—à–∏–π –æ—Ä–¥–µ—Ä
- **–¶–µ–ª—å:** —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- **10%** ‚Üí keeper'—É –∫–æ—Ç–æ—Ä—ã–π –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–ª
- **90%** ‚Üí LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Ö –¥–æ–ª—è–º –≤ –ø—É–ª–µ
- **0%** ‚Üí –≤–ª–∞–¥–µ–ª—å—Ü—É –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤

#### –ü—Ä–∏–º–µ—Ä 1: Swap –Ω–∞ $1000
- **–¢–æ—Ä–≥–æ–≤–∞—è –∫–æ–º–∏—Å—Å–∏—è:** $3 (0.3%)
  - LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ø–æ–ª—É—á–∞—Ç: $2.10 (70%)
  - –°—Ç–µ–π–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—Ç: $0.90 (30%)
- **–ö–æ–º–∏—Å—Å–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:** $1 (0.1% –æ—Ç –≤—ã—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã) ‚Üí keeper'—É
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç:** ~$996 (–∑–∞ –≤—ã—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π)

#### –ü—Ä–∏–º–µ—Ä 2: –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–æ–º $1000
- **Keeper –ø–æ–ª—É—á–∏—Ç:** $100 (10%)
- **LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ø–æ–ª—É—á–∞—Ç:** $900 (90%) - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Ö –¥–æ–ª—è–º
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç:** $0 (–ø–æ–∑–∏—Ü–∏—è –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–∞)

### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–æ—Ö–æ–¥–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**LP –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥):**
- 70% –æ—Ç –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –∫–æ–º–∏—Å—Å–∏–π
- 90% –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–∏—Å–∫–∞

**Keeper'—ã (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –∑–∞ —Ä–∞–±–æ—Ç—É):**
- 0.1% –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞
- 10% –æ—Ç –∫–∞–∂–¥–æ–π –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

**–°—Ç–µ–π–∫–µ—Ä—ã (–ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥):**
- 30% –æ—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö –∫–æ–º–∏—Å—Å–∏–π
- –î–æ—Ö–æ–¥ –∑–∞ –¥–µ—Ä–∂–∞–Ω–∏–µ governance —Ç–æ–∫–µ–Ω–æ–≤

**–¢—Ä–µ–π–¥–µ—Ä—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–ª–∞—Ç—è—Ç):**
- 0.3% —Ç–æ—Ä–≥–æ–≤—ã–µ –∫–æ–º–∏—Å—Å–∏–∏
- 0.1% –∑–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- –ü–æ—Ç–µ—Ä—è –∫–æ–ª–ª–∞—Ç–µ—Ä–∞–ª–∞ –ø—Ä–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

### Flash-loan –∑–∞—â–∏—Ç–∞
```solidity
modifier flashLoanProtection() {
    require(block.number > _lastInteractionBlock[user], "Same block interaction denied");
    _lastInteractionBlock[user] = block.number;
    _;
}
```

### –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
- –ü–∞—Ä–∞–º–µ—Ç—Ä `minAmountOut` –≤–æ –≤—Å–µ—Ö swap —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å tolerance 5%
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ—Ä–æ–Ω—Ç—Ä–∞–Ω–∏–Ω–≥–∞

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤
- `lockFunds()`/`unlockFunds()` –¥–ª—è –æ—Ä–¥–µ—Ä–æ–≤
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–∏—è
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤

---

## üîê –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### DEFAULT_ADMIN_ROLE
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

### KEEPER_ROLE  
- –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
- –û–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä—è–º—ã–µ —Å–≤–∞–ø—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é
- –î–µ–ø–æ–∑–∏—Ç—ã –∏ –≤—ã–≤–æ–¥—ã

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ

### Keeper —Å–∏—Å—Ç–µ–º–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –æ—Ä–¥–µ—Ä–æ–≤
- –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–±—ã—Ç–∫–∞—Ö
- –¶–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –ø—Ä–∞–≤–∞ keeper'–æ–≤
- **–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** —Ä–æ–ª—å `KEEPER_ROLE` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ª—é–±–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–¥—Ä–µ—Å–æ–≤
- **–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è:** –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞—Ä–º–∏—é –±–æ—Ç–æ–≤-keeper'–æ–≤
- **–î–æ—Å—Ç—É–ø:** —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å keeper'–æ–≤ —á–µ—Ä–µ–∑ `grantRole()`
- **–°–∞–º–æ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ self-executable –æ—Ä–¥–µ—Ä–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ù–ï –ú–û–ì–£–¢** –∏—Å–ø–æ–ª–Ω—è—Ç—å —á—É–∂–∏–µ –æ—Ä–¥–µ—Ä–∞ (–∑–∞—â–∏—â–µ–Ω–æ `onlyRole(KEEPER_ROLE)`)
- **–ù–ï –ú–û–ì–£–¢** –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- **–ú–û–ì–£–¢** —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª–Ω—è—Ç—å —Å–≤–æ–∏ –æ—Ä–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ `selfExecuteOrder()`

### –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
```solidity
function shouldExecuteOrder(orderId) returns (bool) {
    // LIMIT: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π —Ü–µ–Ω—ã
    // STOP_LOSS: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å—Ç–æ–ø-—É—Ä–æ–≤–Ω—è
    // MARKET/CONDITIONAL: –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
}
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–ª–∞–Ω—Å–æ–≤ keeper'–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

### –¢–∏–ø—ã –æ—Ä–¥–µ—Ä–æ–≤
1. **STOP_LOSS –æ—Ä–¥–µ—Ä–∞** —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ SHORT (–∑–∞—â–∏—Ç–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ LONG –ø–æ–∑–∏—Ü–∏–π)
2. **MARKET/CONDITIONAL** –æ—Ä–¥–µ—Ä–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ enum, –Ω–æ –ª–æ–≥–∏–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
3. **LONG –∏ SHORT –ø–æ–∑–∏—Ü–∏–∏** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
4. **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏** - –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
5. **–ü–ª–µ—á–æ (leverage)** –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–∞—Å—á–µ—Ç PnL, –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ç–æ—Ä–≥–æ–≤—É—é –º–æ—â–Ω–æ—Å—Ç—å
6. **–ö–æ–ª–ª–∞—Ç–µ—Ä–∞–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é** - –µ—Å–ª–∏ –≤–Ω–µ—Å $100, —Ç–æ—Ä–≥—É–µ—à—å –Ω–∞ $100, –Ω–æ PnL —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ —Å –ø–ª–µ—á–æ–º
7. **–≠—Ç–æ –ù–ï —Ñ—å—é—á–µ—Ä—Å—ã** - –Ω–µ—Ç —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏, –ø–æ—Å—Ç–∞–≤–∫–∏, —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–π–º–∞

### –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
7. **LP —Ç–æ–∫–µ–Ω—ã –Ω–µ –≤—ã–ø—É—Å–∫–∞—é—Ç—Å—è** - —Ç–æ–ª—å–∫–æ —É—á–µ—Ç –¥–æ–ª–µ–π —á–µ—Ä–µ–∑ `liquidityContributions`
8. **–ü—Ä–æ—Å—Ç–æ–π –ø—É–ª** –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π AMM –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏

### –î–æ—Å—Ç—É–ø –∏ —Ä–æ–ª–∏
9. **–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ù–ï –ú–û–ì–£–¢** —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ keeper'—ã
10. **Keeper'–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ** (–Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∞–¥–º–∏–Ω)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –í–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- TradingUpgradeable: v1.0.0
- PoolUpgradeable: v1.1.0
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ upgrades —á–µ—Ä–µ–∑ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø—Ä–æ–∫—Å–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- TradingLibrary - –ª–æ–≥–∏–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π
- PoolLibrary - AMM –º–µ—Ö–∞–Ω–∏–∑–º
- LiquidityLibrary - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é

### –°–æ–±—ã—Ç–∏—è
```solidity
OrderCreated, OrderExecuted, OrderCancelled, OrderModified
PositionOpened, PositionClosed, PositionLiquidated
Swap, Deposit, Withdrawal
LiquidityAdded, LiquidityRemoved, FeeClaimed
```